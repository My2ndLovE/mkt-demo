---
import Layout from '../layouts/Layout.astro';
import Keypad from '../components/Keypad.astro';
---

<Layout title="幸運" headerTitle="幸運" backLink="/">
  <div class="bg-gradient-primary min-h-screen p-4"
       x-data="{
         gameType: '4D',
         drawType: 'D',
         betTypes: { M: true, P: true, T: true, S: false, B: false, K: false, W: false, H: false, E: false },
         currency: 'MYR',
         rows: Array(10).fill(null).map(() => ({ number: '', B: '', S: '', A1: '' })),
         currentRow: 0,
         currentColumn: 'number',
         showKeypad: false,
         total: 0,
         inputValue(val) {
           if (this.currentColumn === 'number') {
             if (this.rows[this.currentRow].number.length < 10) {
               this.rows[this.currentRow].number += val;
             }
           } else {
             this.rows[this.currentRow][this.currentColumn] += val;
           }
         },
         clearInput() {
           if (this.currentColumn === 'number') {
             this.rows[this.currentRow].number = '';
           } else {
             this.rows[this.currentRow][this.currentColumn] = '';
           }
         },
         nextRow() {
           // Cycle through columns: number -> B -> S -> A1 -> next row's number
           if (this.currentColumn === 'number') {
             this.currentColumn = 'B';
           } else if (this.currentColumn === 'B') {
             this.currentColumn = 'S';
           } else if (this.currentColumn === 'S') {
             this.currentColumn = 'A1';
           } else if (this.currentColumn === 'A1') {
             // Move to next row
             if (this.currentRow < 9) {
               this.currentRow++;
               this.currentColumn = 'number';
             }
           }
         },
         focusCell(rowIndex, column) {
           this.currentRow = rowIndex;
           this.currentColumn = column;
           this.showKeypad = true;
         },
         toggleBetType(type) {
           this.betTypes[type] = !this.betTypes[type];
         }
       }">

    <!-- Game Type Selection -->
    <div class="card mb-4 animate-scale-in">
      <div class="flex gap-2 mb-3">
        <button @click="gameType = '3D'" :class="gameType === '3D' ? 'chip-active' : 'chip-inactive'" class="chip flex-1">3D</button>
        <button @click="gameType = '4D'" :class="gameType === '4D' ? 'chip-active' : 'chip-inactive'" class="chip flex-1">4D</button>
        <button @click="gameType = '5D'" :class="gameType === '5D' ? 'chip-active' : 'chip-inactive'" class="chip flex-1">5D</button>
        <button @click="gameType = '6D'" :class="gameType === '6D' ? 'chip-active' : 'chip-inactive'" class="chip flex-1">6D</button>
      </div>

      <!-- Draw Type Selection -->
      <div class="flex gap-2">
        <button @click="drawType = 'D'" :class="drawType === 'D' ? 'chip-active' : 'chip-inactive'" class="chip flex-1">D</button>
        <button @click="drawType = 'D2'" :class="drawType === 'D2' ? 'chip-active' : 'chip-inactive'" class="chip flex-1">D2</button>
        <button @click="drawType = 'D3'" :class="drawType === 'D3' ? 'chip-active' : 'chip-inactive'" class="chip flex-1">D3</button>
        <button @click="drawType = 'D4'" :class="drawType === 'D4' ? 'chip-active' : 'chip-inactive'" class="chip flex-1">D4</button>
        <button @click="drawType = 'D5'" :class="drawType === 'D5' ? 'chip-active' : 'chip-inactive'" class="chip flex-1">D5</button>
      </div>
    </div>

    <!-- Bet Type Selection -->
    <div class="card mb-4 animate-scale-in" style="animation-delay: 0.1s">
      <div class="grid grid-cols-5 gap-2">
        <button @click="toggleBetType('M')" :class="betTypes.M ? 'chip-active' : 'chip-inactive'" class="chip">M</button>
        <button @click="toggleBetType('P')" :class="betTypes.P ? 'chip-active' : 'chip-inactive'" class="chip">P</button>
        <button @click="toggleBetType('T')" :class="betTypes.T ? 'chip-active' : 'chip-inactive'" class="chip">T</button>
        <button @click="toggleBetType('S')" :class="betTypes.S ? 'chip-active' : 'chip-inactive'" class="chip">S</button>
        <button @click="toggleBetType('B')" :class="betTypes.B ? 'chip-active' : 'chip-inactive'" class="chip">B</button>
        <button @click="toggleBetType('K')" :class="betTypes.K ? 'chip-active' : 'chip-inactive'" class="chip">K</button>
        <button @click="toggleBetType('W')" :class="betTypes.W ? 'chip-active' : 'chip-inactive'" class="chip">W</button>
        <button @click="toggleBetType('H')" :class="betTypes.H ? 'chip-active' : 'chip-inactive'" class="chip">H</button>
        <button @click="toggleBetType('E')" :class="betTypes.E ? 'chip-active' : 'chip-inactive'" class="chip">E</button>
      </div>
    </div>

    <!-- Currency Selection -->
    <div class="card mb-4 animate-scale-in" style="animation-delay: 0.2s">
      <div class="flex gap-2">
        <button @click="currency = 'MYR'" :class="currency === 'MYR' ? 'chip-active' : 'chip-inactive'" class="chip flex-1">MYR</button>
        <button @click="currency = 'SGD'" :class="currency === 'SGD' ? 'chip-active' : 'chip-inactive'" class="chip flex-1">SGD</button>
      </div>
    </div>

    <!-- Number Entry Grid with B, S, A1 columns -->
    <div class="card mb-4 animate-scale-in" style="animation-delay: 0.3s">
      <!-- Header -->
      <div class="grid grid-cols-[auto_1fr_60px_60px_60px] gap-2 mb-3">
        <div class="w-8"></div>
        <div class="text-sm font-semibold text-gray-600 text-center">Number</div>
        <div class="text-sm font-semibold text-gray-600 text-center">B</div>
        <div class="text-sm font-semibold text-gray-600 text-center">S</div>
        <div class="text-sm font-semibold text-gray-600 text-center">A1</div>
      </div>

      <!-- Rows -->
      <div class="space-y-2">
        <template x-for="(row, index) in rows" :key="index">
          <div class="grid grid-cols-[auto_1fr_60px_60px_60px] gap-2 items-center">
            <span class="text-gray-500 font-medium text-sm" x-text="`${index + 1}.`"></span>

            <!-- Number Input -->
            <input
              type="text"
              readonly
              :value="row.number"
              @click="focusCell(index, 'number')"
              :class="currentRow === index && currentColumn === 'number' && showKeypad ? 'border-primary-500 ring-2 ring-primary-200' : 'border-gray-200'"
              class="input !py-2 text-base font-mono cursor-pointer"
              placeholder="號碼"
            />

            <!-- B Input -->
            <input
              type="text"
              readonly
              :value="row.B"
              @click="focusCell(index, 'B')"
              :class="currentRow === index && currentColumn === 'B' && showKeypad ? 'border-primary-500 ring-2 ring-primary-200' : 'border-gray-200'"
              class="input !py-2 text-base font-mono cursor-pointer text-center"
              placeholder=""
            />

            <!-- S Input -->
            <input
              type="text"
              readonly
              :value="row.S"
              @click="focusCell(index, 'S')"
              :class="currentRow === index && currentColumn === 'S' && showKeypad ? 'border-primary-500 ring-2 ring-primary-200' : 'border-gray-200'"
              class="input !py-2 text-base font-mono cursor-pointer text-center"
              placeholder=""
            />

            <!-- A1 Input -->
            <input
              type="text"
              readonly
              :value="row.A1"
              @click="focusCell(index, 'A1')"
              :class="currentRow === index && currentColumn === 'A1' && showKeypad ? 'border-primary-500 ring-2 ring-primary-200' : 'border-gray-200'"
              class="input !py-2 text-base font-mono cursor-pointer text-center"
              placeholder=""
            />
          </div>
        </template>
      </div>
    </div>

    <!-- Total Display -->
    <div class="card bg-gradient-to-r from-green-500 to-green-600 text-white mb-24 animate-scale-in" style="animation-delay: 0.4s">
      <div class="flex items-center justify-between">
        <span class="text-lg">總計:</span>
        <span class="text-3xl font-bold" x-text="`${currency} ${total.toFixed(2)}`">MYR 0.00</span>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white shadow-2xl safe-bottom" x-show="!showKeypad">
      <button class="btn btn-primary w-full text-lg">提交投注</button>
    </div>

    <!-- Keypad Component -->
    <Keypad />
  </div>
</Layout>
